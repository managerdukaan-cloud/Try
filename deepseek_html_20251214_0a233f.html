<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raashanmart - Shopkeeper Panel</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3082/3082383.png" type="image/x-icon">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Cloudinary Widget Script -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        /* ALL ORIGINAL STYLES REMAIN EXACTLY THE SAME */
        :root {
            --primary: #0F2C59;
            --secondary: #F8F0E5;
            --accent: #EADBC8;
            --text: #333;
            --white: #fff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary);
            color: var(--text);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: var(--primary);
            color: var(--white);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--white);
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--white);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--accent);
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            color: var(--white);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3, var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 44, 89, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }
        
        .btn-outline:hover {
            background: rgba(234, 219, 200, 0.1);
            color: var(--accent);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            color: #212529;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
            color: white;
        }
        
        /* Main Content */
        main {
            margin-top: 80px;
            min-height: calc(100vh - 160px);
            padding: 2rem 0;
        }
        
        /* Auth Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }
        
        .auth-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary);
        }
        
        /* Dashboard Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 0.5rem 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Dashboard Orders Summary */
        .dashboard-orders-summary {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .dashboard-orders-summary h4 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dashboard-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .dashboard-stat {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            background: #f8f9fa;
        }
        
        .dashboard-stat.pending {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
        
        .dashboard-stat.confirmed {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }
        
        .dashboard-stat.preparing {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        
        .dashboard-stat.delivered {
            background: #c3e6cb;
            border: 1px solid #b1dfbb;
        }
        
        .dashboard-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        
        .dashboard-stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* ===== ENHANCED PRODUCT CARD STYLES ===== */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.8rem;
            padding: 1.5rem 0;
        }

        .product-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .product-image-container {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.08);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, var(--primary), #0056b3);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            z-index: 2;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            letter-spacing: 0.3px;
        }

        .product-details {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1.4;
            height: 48px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            margin: 0;
            letter-spacing: -0.2px;
        }

        .product-price-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 0.5rem 0;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--primary);
        }

        .product-mrp {
            font-size: 0.95rem;
            color: #999;
            text-decoration: line-through;
        }

        .product-discount {
            font-size: 0.85rem;
            color: #27ae60;
            font-weight: 700;
            background: #eafaf1;
            padding: 4px 10px;
            border-radius: 12px;
            border: 1px solid #d4f1e0;
        }

        .product-stock {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            margin: 0.2rem 0;
        }

        .product-stock.in-stock {
            color: #27ae60;
        }

        .product-stock.low-stock {
            color: #f39c12;
        }

        .product-stock.out-of-stock {
            color: #e74c3c;
        }

        .product-actions {
            display: flex;
            gap: 0.6rem;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
        }

        .btn-add-product, .btn-edit-product {
            flex: 1;
            padding: 0.7rem 1rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-add-product {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            color: white;
            box-shadow: 0 4px 12px rgba(15, 44, 89, 0.2);
        }

        .btn-add-product:hover {
            background: linear-gradient(135deg, #0056b3, var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(15, 44, 89, 0.3);
        }

        .btn-edit-product {
            background: #f8f9fa;
            color: var(--text);
            border: 1px solid #e0e0e0;
        }

        .btn-edit-product:hover {
            background: #e9ecef;
            border-color: #b0b0b0;
            transform: translateY(-2px);
        }

        /* Product Category Badge */
        .product-category {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(15, 44, 89, 0.1);
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            align-self: flex-start;
        }

        /* Orders Summary Card */
        .orders-summary-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            text-align: center;
        }

        .summary-stat {
            padding: 10px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .summary-stat.pending {
            background: #fff3cd;
            color: #856404;
        }

        .summary-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
        }

        .summary-stat-label {
            font-size: 0.8rem;
            display: block;
        }

        /* Time Inputs */
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .time-input-group input {
            flex: 1;
        }

        /* Service Type Options */
        .service-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .service-option {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .service-option.active {
            border-color: var(--primary);
            background: rgba(15, 44, 89, 0.1);
        }

        .service-option i {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--primary);
        }

        /* Shop Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-open {
            background: #d4edda;
            color: #155724;
        }

        .status-closed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-busy {
            background: #fff3cd;
            color: #856404;
        }

        .status-holiday {
            background: #d1ecf1;
            color: #0c5460;
        }

        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--primary);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            background: #fff;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(15, 44, 89, 0.1);
        }
        
        /* Checkbox Styles */
        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .form-check:hover {
            background: #e9ecef;
        }
        
        .form-check-input {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .form-check-label {
            cursor: pointer;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 3000;
            max-width: 400px;
        }
        
        .toast {
            background: var(--primary);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            animation: slideIn 0.3s ease;
        }
        
        .toast.success {
            background: var(--success);
        }
        
        .toast.error {
            background: var(--danger);
        }
        
        .toast.warning {
            background: var(--warning);
            color: var(--text);
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Table Styles */
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .table th,
        .table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .table th {
            background: var(--primary);
            color: var(--white);
            font-weight: 600;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }

        /* Status Text Styles */
        .status-text {
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .status-pending {
            color: #856404;
            background-color: #fff3cd;
        }
        
        .status-confirmed {
            color: #004085;
            background-color: #cce5ff;
        }
        
        .status-preparing {
            color: #0c5460;
            background-color: #d1ecf1;
        }
        
        .status-packed {
            color: #856404;
            background-color: #fff3cd;
        }
        
        .status-ready_for_pickup {
            color: #155724;
            background-color: #d4edda;
        }
        
        .status-picked_up {
            color: #155724;
            background-color: #d4edda;
        }
        
        .status-dispatched {
            color: #856404;
            background-color: #fff3cd;
        }
        
        .status-out_for_delivery {
            color: #856404;
            background-color: #fff3cd;
        }
        
        .status-delivered {
            color: #155724;
            background-color: #d4edda;
        }
        
        .status-cancelled {
            color: #721c24;
            background-color: #f8d7da;
        }
        
        .status-rejected {
            color: #721c24;
            background-color: #f8d7da;
        }

        /* Refund Status Styles */
        .status-refund_pending {
            color: #856404;
            background-color: #fff3cd;
        }
        
        .status-refund_completed {
            color: #155724;
            background-color: #d4edda;
        }
        
        .status-refund_rejected {
            color: #721c24;
            background-color: #f8d7da;
        }
        
        /* Payment Text Styles */
        .payment-text {
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .payment-cod-paid {
            color: #155724;
            background-color: #d4edda;
        }
        
        .payment-cod-unpaid {
            color: #856404;
            background-color: #fff3cd;
        }
        
        .payment-online-paid {
            color: #155724;
            background-color: #d4edda;
        }
        
        .payment-online-unpaid {
            color: #721c24;
            background-color: #f8d7da;
        }
        
        .payment-paid {
            color: #155724;
            background-color: #d4edda;
        }
        
        .payment-unpaid {
            color: #856404;
            background-color: #fff3cd;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #f0f0f0;
            color: #333;
        }

        /* Content Pages */
        .content-page {
            display: none;
        }
        
        .content-page.active {
            display: block;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Item Quantity Control Styles */
        .item-quantity-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .item-quantity-control .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .item-price {
            font-size: 0.85rem;
            color: #666;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .quantity-btn:disabled {
            background: #f8f9fa;
            color: #ccc;
            cursor: not-allowed;
        }

        .quantity-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .max-quantity {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        /* Refund Item Styles */
        .refund-item-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .refund-item-control .item-info {
            flex: 1;
        }

        .refund-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .refund-quantity {
            width: 60px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Order Details Modal - FULL SCREEN */
        .order-details-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 3000;
            overflow-y: auto;
            display: none;
        }

        .order-details-fullscreen.active {
            display: block;
        }

        .order-details-header {
            background: var(--primary);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .order-details-header h2 {
            margin: 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-details-content {
            padding: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .order-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .order-section h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .order-section h4 i {
            font-size: 1.2rem;
        }

        .order-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .order-info-item {
            margin-bottom: 0.75rem;
        }

        .order-info-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .order-info-value {
            font-size: 1rem;
            color: #333;
        }

        .order-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .order-items-table th {
            background: var(--primary);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        .order-items-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
        }

        .order-items-table tr:last-child td {
            border-bottom: none;
        }

        .order-total {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            text-align: right;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .order-total .total-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* Customer Info Styles */
        .customer-info-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* Image Upload Styles */
        .image-upload-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .image-upload-option {
            display: flex;
            gap: 1rem;
        }

        .upload-tab {
            flex: 1;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .upload-tab.active {
            border-color: var(--primary);
            background: rgba(15, 44, 89, 0.05);
        }

        .upload-tab i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .image-preview-container {
            display: none;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-preview-container.active {
            display: flex;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px dashed #ddd;
            padding: 0.5rem;
        }

        .upload-input {
            display: none;
        }

        .upload-btn {
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            background: #0056b3;
        }

        .progress {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        /* Settings Page Styles */
        .settings-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .settings-section h4 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-right: 15px;
            vertical-align: middle;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .toggle-label i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .settings-description {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .settings-form-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: white;
            border-radius: 10px;
            border: 2px dashed #ddd;
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* Refund Options Styles */
        .refund-options-section {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .refund-option-row {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .refund-option-checkbox {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }

        .refund-option-details {
            flex: 1;
        }

        .refund-option-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .refund-option-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .refund-option-condition {
            font-size: 0.85rem;
            color: #888;
            font-style: italic;
        }

        /* Order Items Status Control */
        .order-item-status-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .order-item-status-control .item-info {
            flex: 1;
        }

        .order-item-status-control select {
            min-width: 150px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        /* Settings Cards - IMPROVED */
        .settings-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }

        .settings-card h5 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 0.75rem;
        }

        /* Enhanced Form Controls */
        .settings-card .btn {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 1rem;
            min-width: 160px;
        }

        .settings-card .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            border: none;
        }

        .settings-card .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3, var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 44, 89, 0.3);
        }

        .settings-card .btn-outline {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }

        .settings-card .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Order Items Status */
        .order-item-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .order-item-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .order-item-status.preparing {
            background: #d1ecf1;
            color: #0c5460;
        }

        .order-item-status.packed {
            background: #fff3cd;
            color: #856404;
        }

        .order-item-status.ready {
            background: #d4edda;
            color: #155724;
        }

        .order-item-status.delivered {
            background: #d4edda;
            color: #155724;
        }

        .order-item-status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .action-btn i {
            font-size: 0.9rem;
        }

        /* Profile Page Styles */
        .profile-form-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }

        .profile-form-container .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            padding: 0.75rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-links {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }
            
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .service-options {
                grid-template-columns: 1fr;
            }

            .image-upload-option {
                flex-direction: column;
            }

            .order-details-header h2 {
                font-size: 1.2rem;
            }

            .order-details-content {
                padding: 1rem;
            }

            .order-section {
                padding: 1rem;
            }

            .order-grid {
                grid-template-columns: 1fr;
            }

            .order-items-table {
                display: block;
                overflow-x: auto;
            }

            .table-responsive {
                overflow-x: auto;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .settings-card {
                padding: 1rem;
            }

            .settings-card h5 {
                font-size: 1.1rem;
            }

            .settings-card .btn {
                width: 100%;
                margin-top: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .auth-card {
                padding: 1.5rem;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .modal-content {
                padding: 1.5rem;
            }
        }

        /* Desktop View Specific */
        @media (min-width: 769px) {
            .order-details-content {
                padding: 2rem;
            }
            
            .order-section {
                padding: 2rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        /* App-like Mobile View */
        @media (max-width: 768px) {
            body {
                background: white;
            }
            
            main {
                margin-top: 70px;
                padding: 1rem 0;
                margin-bottom: 60px;
            }
            
            .container {
                padding: 0 15px;
            }
            
            .content-page.active {
                animation: slideIn 0.3s ease;
            }
            
            .stat-card {
                padding: 1.2rem;
                margin-bottom: 1rem;
            }
            
            .dashboard-orders-summary {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .orders-summary-card {
                padding: 15px;
                margin-bottom: 15px;
            }
        }

        /* Floating Orders Button */
        .floating-orders-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .floating-orders-btn.active {
            display: flex;
        }

        .floating-orders-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Quick Actions Toolbar */
        .quick-actions-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            padding: 10px;
            display: none;
            justify-content: space-around;
            z-index: 999;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: #666;
            font-size: 0.8rem;
            gap: 5px;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .quick-action-btn.active {
            background: var(--primary);
            color: white;
        }

        .quick-action-btn i {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .quick-actions-toolbar {
                display: flex;
            }
            
            main {
                margin-bottom: 60px;
            }
        }

        /* Offline Warning */
        .offline-warning {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            background: #f39c12;
            color: white;
            padding: 10px 20px;
            text-align: center;
            z-index: 9999;
            display: none;
            font-weight: bold;
        }

        .offline-warning i {
            margin-right: 10px;
        }

        /* Timeline Styles for Refund Details */
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin: 1rem 0;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .timeline-marker {
            position: absolute;
            left: -2rem;
            top: 0.25rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
        }

        .timeline-content {
            padding-left: 1rem;
        }

        .timeline-content h6 {
            margin-bottom: 0.25rem;
            color: #495057;
        }

        /* NEW STYLES FOR ENHANCED FEATURES */
        
        /* Analytics Charts */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-card h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Inventory Alerts */
        .inventory-alerts-panel {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #ffc107;
        }
        
        .inventory-alerts-panel h4 {
            color: #856404;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            transition: all 0.3s;
        }
        
        .alert-item:hover {
            background: #f8f9fa;
        }
        
        .alert-item:last-child {
            border-bottom: none;
        }
        
        .alert-item.low-stock {
            border-left: 3px solid #ffc107;
        }
        
        .alert-item.out-of-stock {
            border-left: 3px solid #dc3545;
        }
        
        /* Bulk Operations */
        .bulk-operations-panel {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .bulk-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1rem;
        }
        
        .bulk-upload-area:hover {
            border-color: var(--primary);
            background: rgba(15, 44, 89, 0.05);
        }
        
        .bulk-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(15, 44, 89, 0.1);
        }
        
        /* Export Options */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .export-option {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .export-option:hover {
            border-color: var(--primary);
            background: rgba(15, 44, 89, 0.05);
            transform: translateY(-2px);
        }
        
        .export-option i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
            padding: 1rem;
        }
        
        .page-info {
            color: #666;
            font-weight: 500;
        }
        
        /* Security Badge */
        .security-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Lazy Loading */
        .lazy-image {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .lazy-image.loaded {
            opacity: 1;
        }
        
        /* Performance Indicators */
        .performance-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Offline Warning -->
    <div class="offline-warning" id="offlineWarning">
        <i class="fas fa-wifi-slash"></i> No Internet Connection
    </div>

    <!-- Performance Indicator (Debug) -->
    <div class="performance-indicator" id="performanceIndicator">
        <span id="loadTime">0ms</span>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo"> Raashanmart Shop</div>
                <div class="nav-links">
                    <a href="#" data-page="dashboard">Dashboard</a>
                    <a href="#" data-page="products">Products</a>
                    <a href="#" data-page="orders">Orders <span class="orders-badge" style="display: none;">0</span></a>
                    <a href="#" data-page="analytics">Analytics</a>
                    <a href="#" data-page="refunds">Refunds</a>
                    <a href="#" data-page="settings">Settings</a>
                    <a href="#" data-page="profile">Profile</a>
                    <button class="btn btn-outline" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>

            <!-- Auth Screen -->
            <div id="authScreen">
                <div class="auth-container">
                    <div class="auth-card">
                        <h2 class="auth-title">Shopkeeper Login</h2>
                        <div id="debugInfo" style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 12px; display: none;">
                            <strong>Debug Info:</strong> <span id="debugText"></span>
                        </div>
                        <form id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">Email</label>
                                <input type="email" id="loginEmail" required placeholder="Enter your email">
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input type="password" id="loginPassword" required placeholder="Enter your password">
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Login</button>
                            <div class="text-center mt-3">
                              <a href="#" onclick="showForgotPassword()" class="text-muted">Forgot Password?</a>
                            </div>
                        </form>
                        <div style="text-align: center; margin-top: 1rem;">
                            <small>Don't have an account? Contact admin</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- App Screen -->
            <div id="appScreen" style="display: none;">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="content-page active">
                    <h2 style="margin-bottom: 2rem; color: var(--primary);">Dashboard</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Products</div>
                            <div class="stat-value" id="totalProducts">0</div>
                            <div class="stat-change" id="productsChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Pending Orders</div>
                            <div class="stat-value" id="pendingOrders">0</div>
                            <div class="stat-change" id="ordersChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Today's Revenue</div>
                            <div class="stat-value" id="todayRevenue">0</div>
                            <div class="stat-change" id="revenueChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Pending Refunds</div>
                            <div class="stat-value" id="pendingRefunds">0</div>
                            <div class="stat-change" id="refundsChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Orders Summary -->
                    <div class="dashboard-orders-summary" id="dashboardOrdersSummary">
                        <h4><i class="fas fa-shopping-bag"></i> Order Management Summary</h4>
                        <div class="dashboard-stats-grid" id="dashboardOrdersStats">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Inventory Alerts -->
                    <div class="inventory-alerts-panel" id="inventoryAlerts" style="display: none;">
                        <h4><i class="fas fa-exclamation-triangle"></i> Inventory Alerts</h4>
                        <div id="alertItems">
                            <!-- Alerts will be populated here -->
                        </div>
                    </div>

                    <!-- Quick Charts -->
                    <div class="charts-container" id="dashboardCharts">
                        <div class="chart-card">
                            <h4><i class="fas fa-chart-line"></i> Revenue Trend</h4>
                            <canvas id="revenueChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <h4><i class="fas fa-chart-pie"></i> Order Status</h4>
                            <canvas id="ordersChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="navigateToPage('products')">
                            <i class="fas fa-box"></i> Manage Products
                        </button>
                        <button class="btn btn-outline" onclick="navigateToPage('orders')">
                            <i class="fas fa-shopping-bag"></i> View Orders
                        </button>
                        <button class="btn btn-primary" onclick="navigateToPage('analytics')">
                            <i class="fas fa-chart-bar"></i> View Analytics
                        </button>
                        <button class="btn btn-outline" onclick="navigateToPage('refunds')">
                            <i class="fas fa-exchange-alt"></i> Manage Refunds
                        </button>
                        <button class="btn btn-outline" onclick="navigateToPage('settings')">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                    </div>
                </div>

                <!-- Products Page -->
                <div id="productsPage" class="content-page">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="color: var(--primary);">Product Management</h2>
                        <div style="display: flex; gap: 1rem;">
                            <input type="text" id="productSearch" placeholder="Search products..." class="form-control" style="margin: 0; min-width: 200px;">
                            <button class="btn btn-primary" onclick="showAddProductModal()">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                            <button class="btn btn-outline" onclick="showBulkUpload()">
                                <i class="fas fa-upload"></i> Bulk Upload
                            </button>
                            <button class="btn btn-info" onclick="exportProducts()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <!-- Bulk Upload Panel -->
                    <div class="bulk-operations-panel" id="bulkUploadPanel" style="display: none;">
                        <h4><i class="fas fa-upload"></i> Bulk Product Upload</h4>
                        <div class="bulk-upload-area" id="bulkUploadArea">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted"></i>
                            <p>Drag & drop CSV file here or click to browse</p>
                            <input type="file" id="bulkUploadFile" accept=".csv" style="display: none;">
                            <button class="btn btn-outline btn-sm" onclick="document.getElementById('bulkUploadFile').click()">
                                Browse Files
                            </button>
                        </div>
                        <div class="mt-2">
                            <a href="#" onclick="downloadTemplate()" class="text-primary">
                                <i class="fas fa-download"></i> Download CSV Template
                            </a>
                            <small class="text-muted d-block mt-1">Required columns: name, price, stock, category</small>
                        </div>
                    </div>

                    <!-- Inventory Alerts -->
                    <div class="inventory-alerts-panel" id="productsInventoryAlerts" style="display: none;">
                        <h4><i class="fas fa-exclamation-triangle"></i> Inventory Alerts</h4>
                        <div id="productsAlertItems">
                            <!-- Alerts will be populated here -->
                        </div>
                    </div>

                    <div class="products-grid" id="productsList">
                        <!-- Products will be loaded here -->
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" id="productsPagination" style="display: none;">
                        <button class="btn btn-outline" onclick="loadPreviousPage()">
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span id="pageInfo" class="page-info">Page 1 of 1</span>
                        <button class="btn btn-outline" onclick="loadNextPage()">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div id="analyticsPage" class="content-page">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="color: var(--primary);">Analytics & Reports</h2>
                        <div style="display: flex; gap: 1rem;">
                            <select id="analyticsPeriod" class="form-select" style="max-width: 200px;">
                                <option value="7">Last 7 Days</option>
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                            </select>
                            <button class="btn btn-primary" onclick="loadAnalytics()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-info" onclick="showReportModal()">
                                <i class="fas fa-download"></i> Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Analytics Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Sales</div>
                            <div class="stat-value" id="totalSales">0</div>
                            <div class="stat-change" id="salesChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Orders Completed</div>
                            <div class="stat-value" id="completedOrders">0</div>
                            <div class="stat-change" id="completedOrdersChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Average Order Value</div>
                            <div class="stat-value" id="avgOrderValue">0</div>
                            <div class="stat-change" id="avgOrderValueChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Customer Satisfaction</div>
                            <div class="stat-value" id="customerSatisfaction">0%</div>
                            <div class="stat-change" id="satisfactionChange">
                                <i class="fas fa-arrow-up text-success"></i> <span>0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-container">
                        <div class="chart-card">
                            <h4><i class="fas fa-chart-line"></i> Sales Performance</h4>
                            <canvas id="salesChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <h4><i class="fas fa-chart-bar"></i> Top Products</h4>
                            <canvas id="topProductsChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <h4><i class="fas fa-chart-pie"></i> Category Distribution</h4>
                            <canvas id="categoryChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <h4><i class="fas fa-chart-area"></i> Customer Growth</h4>
                            <canvas id="customerChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <!-- Export Options -->
                    <div class="settings-card">
                        <h5><i class="fas fa-file-export"></i> Export Reports</h5>
                        <div class="export-options">
                            <div class="export-option" onclick="exportSalesReport()">
                                <i class="fas fa-shopping-cart"></i>
                                <div>Sales Report</div>
                            </div>
                            <div class="export-option" onclick="exportInventoryReport()">
                                <i class="fas fa-boxes"></i>
                                <div>Inventory Report</div>
                            </div>
                            <div class="export-option" onclick="exportCustomerReport()">
                                <i class="fas fa-users"></i>
                                <div>Customer Report</div>
                            </div>
                            <div class="export-option" onclick="exportFinancialReport()">
                                <i class="fas fa-chart-line"></i>
                                <div>Financial Report</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Page (Original - Unchanged) -->
                <div id="ordersPage" class="content-page">
                    <h2 style="margin-bottom: 1rem; color: var(--primary);">Order Management</h2>
                    
                    <!-- Orders Summary Card -->
                    <div class="orders-summary-card" id="ordersSummaryCard">
                        <h4 style="margin-bottom: 10px;"> Quick Summary</h4>
                        <div class="summary-stats">
                            <div class="summary-stat pending">
                                <span class="summary-stat-value" id="pendingSummary">0</span>
                                <span class="summary-stat-label">Pending</span>
                            </div>
                            <div class="summary-stat">
                                <span class="summary-stat-value" id="confirmedSummary">0</span>
                                <span class="summary-stat-label">Confirmed</span>
                            </div>
                            <div class="summary-stat">
                                <span class="summary-stat-value" id="preparingSummary">0</span>
                                <span class="summary-stat-label">Preparing</span>
                            </div>
                            <div class="summary-stat">
                                <span class="summary-stat-value" id="totalSummary">0</span>
                                <span class="summary-stat-label">Total</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Filter -->
                    <div class="mb-3">
                        <select id="orderStatusFilter" class="form-select" style="max-width: 200px;" onchange="filterOrders()">
                            <option value="all">All Orders</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="preparing">Preparing</option>
                            <option value="packed">Packed</option>
                            <option value="ready_for_pickup">Ready for Pickup</option>
                            <option value="out_for_delivery">Out for Delivery</option>
                            <option value="delivered">Delivered</option>
                            <option value="picked_up">Picked Up</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Payment</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersList">
                                <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Refunds Page (Original - Unchanged) -->
                <div id="refundsPage" class="content-page">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="color: var(--primary);">Refund Management</h2>
                        <div style="display: flex; gap: 1rem;">
                            <select id="refundStatusFilter" class="form-select" style="max-width: 200px;" onchange="filterRefunds()">
                                <option value="all">All Refunds</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                    </div>

                    <!-- Refunds Summary -->
                    <div class="stats-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card">
                            <div class="stat-label">Pending Refunds</div>
                            <div class="stat-value" id="refundStatsPending">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Completed Refunds</div>
                            <div class="stat-value" id="refundStatsCompleted">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Rejected Refunds</div>
                            <div class="stat-value" id="refundStatsRejected">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Refund Amount</div>
                            <div class="stat-value" id="refundStatsAmount">0</div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Refund ID</th>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Initiated On</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="refundsList">
                                <!-- Refunds will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Page (Original - Unchanged) -->
                <div id="settingsPage" class="content-page">
                    <h2 style="margin-bottom: 2rem; color: var(--primary);">Shop Settings</h2>
                    
                    <!-- UPI & Payment Settings Card -->
                    <div class="settings-card">
                        <h5><i class="fas fa-qrcode"></i> UPI & Payment Settings</h5>
                        <form id="upiSettingsForm">
                            <div class="form-group">
                                <label for="upiId">UPI ID</label>
                                <input type="text" id="upiId" placeholder="yourname@upi" class="form-control">
                                <small class="text-muted">Enter your UPI ID for QR code payments</small>
                            </div>
                            <div class="form-group">
                                <label for="qrCodeImage">QR Code Image URL</label>
                                <input type="text" id="qrCodeImage" placeholder="https://example.com/qr-code.png" class="form-control">
                                <small class="text-muted">Upload your QR code image and enter the URL here</small>
                            </div>
                            <div class="form-group">
                                <label>Accepted Payment Methods</label>
                                <div style="margin-top: 10px;">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="acceptCash" checked>
                                        <label class="form-check-label" for="acceptCash">
                                            <i class="fas fa-money-bill-wave"></i> Cash
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="acceptUPI" checked>
                                        <label class="form-check-label" for="acceptUPI">
                                            <i class="fas fa-qrcode"></i> UPI/QR Code
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="acceptCard">
                                        <label class="form-check-label" for="acceptCard">
                                            <i class="fas fa-credit-card"></i> Card
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveUPISettings()">
                                <i class="fas fa-save"></i> Save Payment Settings
                            </button>
                        </form>
                    </div>

                    <!-- Coupon Management Card -->
                    <div class="settings-card">
                        <h5><i class="fas fa-ticket-alt"></i> Coupon Management</h5>
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="couponSystemEnabled" onchange="toggleCouponSystem()">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="font-weight: 600; margin-left: 10px;" id="couponSystemStatus">Coupon System: Disabled</span>
                        </div>
                        
                        <div id="couponSettingsSection" style="display: none;">
                            <div class="settings-form-section">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Coupon Code</label>
                                        <input type="text" id="couponCode" placeholder="SHOP10" maxlength="10" class="form-control">
                                        <small class="text-muted">Max 10 characters</small>
                                    </div>
                                    <div class="form-group">
                                        <label>Discount Type</label>
                                        <select id="couponDiscountType" class="form-control">
                                            <option value="percentage">Percentage (%)</option>
                                            <option value="fixed">Fixed Amount ()</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Discount Value</label>
                                        <input type="number" id="couponValue" min="0" step="0.01" class="form-control">
                                        <small class="text-muted">Percentage (1-100) or Fixed Amount</small>
                                    </div>
                                    <div class="form-group">
                                        <label>Minimum Order Amount ()</label>
                                        <input type="number" id="couponMinOrder" min="0" step="0.01" class="form-control">
                                        <small class="text-muted">Minimum cart value to apply coupon</small>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Maximum Discount ()</label>
                                        <input type="number" id="couponMaxDiscount" min="0" step="0.01" class="form-control">
                                        <small class="text-muted">0 for no limit</small>
                                    </div>
                                    <div class="form-group">
                                        <label>Valid Until</label>
                                        <input type="date" id="couponValidUntil" class="form-control">
                                        <small class="text-muted">Leave empty for no expiry</small>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Usage Limit</label>
                                        <input type="number" id="couponUsageLimit" min="0" class="form-control">
                                        <small class="text-muted">0 for unlimited uses</small>
                                    </div>
                                    <div class="form-group">
                                        <label>Active</label>
                                        <select id="couponActive" class="form-control">
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Coupon Description</label>
                                    <textarea id="couponDescription" rows="2" class="form-control" placeholder="Describe this coupon..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <button type="button" class="btn btn-primary" onclick="saveCouponSettings()">
                                        <i class="fas fa-save"></i> Save Coupon Settings
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="clearCouponForm()">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shop Restrictions Card -->
                    <div class="settings-card">
                        <h5><i class="fas fa-ban"></i> Shop Restrictions</h5>
                        <form id="restrictionsForm">
                            <div class="form-group">
                                <label>Maximum Order Distance (km)</label>
                                <input type="number" id="maxOrderDistance" min="0" max="50" step="1" class="form-control">
                                <small class="text-muted">0 for no limit, maximum 50km</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Minimum Order Amount ()</label>
                                <input type="number" id="minOrderAmount" min="0" step="0.01" class="form-control">
                                <small class="text-muted">Minimum amount for order placement</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Maximum Items per Order</label>
                                <input type="number" id="maxItemsPerOrder" min="0" class="form-control">
                                <small class="text-muted">0 for no limit</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Delivery Hours</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Start Time</label>
                                        <input type="time" id="deliveryStartTime" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>End Time</label>
                                        <input type="time" id="deliveryEndTime" class="form-control">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Blocked Customers</label>
                                <textarea id="blockedCustomers" rows="3" class="form-control" placeholder="Enter customer IDs or phone numbers separated by commas"></textarea>
                                <small class="text-muted">These customers won't be able to place orders</small>
                            </div>
                            
                            <button type="button" class="btn btn-primary" onclick="saveRestrictions()">
                                <i class="fas fa-save"></i> Save Restrictions
                            </button>
                        </form>
                    </div>

                    <!-- Order Management Settings Card -->
                    <div class="settings-card">
                        <h5><i class="fas fa-cogs"></i> Order Management Settings</h5>
                        <form id="orderSettingsForm">
                            <div class="form-group">
                                <label>Auto-Accept Orders</label>
                                <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="autoAcceptOrders">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span style="margin-left: 10px;">Automatically accept incoming orders</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Auto-Reject Orders When</label>
                                <div style="margin-top: 10px;">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rejectOutOfStock">
                                        <label class="form-check-label" for="rejectOutOfStock">
                                            Items are out of stock
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rejectAfterHours">
                                        <label class="form-check-label" for="rejectAfterHours">
                                            Order placed outside business hours
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rejectBelowMinAmount">
                                        <label class="form-check-label" for="rejectBelowMinAmount">
                                            Order amount below minimum
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Default Preparation Time (minutes)</label>
                                <input type="number" id="defaultPrepTime" min="5" max="180" class="form-control">
                                <small class="text-muted">Estimated time to prepare orders</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Order Status Notifications</label>
                                <div style="margin-top: 10px;">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notifyOnAccept" checked>
                                        <label class="form-check-label" for="notifyOnAccept">
                                            Notify customer when order is accepted
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notifyOnReady" checked>
                                        <label class="form-check-label" for="notifyOnReady">
                                            Notify when order is ready
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notifyOnDelivery" checked>
                                        <label class="form-check-label" for="notifyOnDelivery">
                                            Notify when order is out for delivery
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-primary" onclick="saveOrderSettings()">
                                <i class="fas fa-save"></i> Save Order Settings
                            </button>
                        </form>
                    </div>

                    <!-- Advanced Settings Card -->
                    <div class="settings-card">
                        <h5><i class="fas fa-sliders-h"></i> Advanced Settings</h5>
                        <div class="form-group">
                            <label>Shop Configuration Sync</label>
                            <button type="button" class="btn btn-outline" onclick="syncShopConfig()">
                                <i class="fas fa-sync"></i> Sync with Customer App
                            </button>
                            <small class="text-muted d-block mt-1">Sync your settings with the customer app</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Data Export</label>
                            <button type="button" class="btn btn-outline" onclick="exportShopData()">
                                <i class="fas fa-download"></i> Export Shop Data
                            </button>
                            <small class="text-muted d-block mt-1">Export products, orders, and settings</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Reset Settings</label>
                            <button type="button" class="btn btn-danger" onclick="resetSettings()">
                                <i class="fas fa-trash"></i> Reset to Defaults
                            </button>
                            <small class="text-muted d-block mt-1">This will reset all settings to default values</small>
                        </div>
                    </div>
                </div>

                <!-- Profile Page (Original - Unchanged) -->
                <div id="profilePage" class="content-page">
                    <h2 style="margin-bottom: 2rem; color: var(--primary);">Shop Profile</h2>
                    
                    <div class="profile-form-container">
                        <form id="profileForm">
                            <div class="form-group">
                                <label>Shop Name</label>
                                <input type="text" id="shopName" required>
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="shopCategory" required>
                                    <option value="groceries">Groceries</option>
                                    <option value="cosmetics">Cosmetics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="medical">Medical</option>
                                    <option value="stationery">Stationery</option>
                                    <option value="other">Other (Create New)</option>
                                </select>
                            </div>
                            <div id="newCategoryInput" style="display: none;">
                                <div class="form-group">
                                    <label>New Category Name</label>
                                    <input type="text" id="newCategoryName" placeholder="Enter new category name">
                                    <small class="text-muted">This category will be available for your products and in customer app</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="shopDescription" rows="3" placeholder="Describe your shop..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Address</label>
                                <textarea id="shopAddress" rows="2" required placeholder="Full shop address"></textarea>
                            </div>
                            
                            <!-- Shop Timings Section -->
                            <div class="form-group">
                                <label>Shop Timings</label>
                                <div class="time-input-group">
                                    <input type="time" id="shopOpenTime" value="09:00">
                                    <span>to</span>
                                    <input type="time" id="shopCloseTime" value="21:00">
                                </div>
                            </div>
                            
                            <!-- Service Type Section -->
                            <div class="form-group">
                                <label>Service Type</label>
                                <div class="service-options" id="serviceOptions">
                                    <div class="service-option" data-value="both">
                                        <i class="fas fa-truck"></i>
                                        <span>Both Delivery & Pickup</span>
                                    </div>
                                    <div class="service-option" data-value="delivery_only">
                                        <i class="fas fa-motorcycle"></i>
                                        <span>Delivery Only</span>
                                    </div>
                                    <div class="service-option" data-value="pickup_only">
                                        <i class="fas fa-store"></i>
                                        <span>Pickup Only</span>
                                    </div>
                                </div>
                                <input type="hidden" id="deliveryType" value="both">
                            </div>
                            
                            <!-- Shop Status Section -->
                            <div class="form-group">
                                <label>Shop Status</label>
                                <select id="shopStatus">
                                    <option value="open"> Open</option>
                                    <option value="closed"> Closed</option>
                                    <option value="busy"> Busy (Accepting orders)</option>
                                    <option value="holiday"> On Holiday</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="shopPhone" required placeholder="+91 1234567890">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ALL ORIGINAL MODALS REMAIN EXACTLY THE SAME -->
    <!-- Product Modal with Cloudinary Image Upload -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add New Product</h3>
                <button class="close-modal" onclick="closeProductModal()">&times;</button>
            </div>
            <form id="productForm">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="productCategory" required>
                        <option value="groceries">Groceries</option>
                        <option value="dairy">Dairy</option>
                        <option value="bakery">Bakery</option>
                        <option value="beverages">Beverages</option>
                        <option value="snacks">Snacks</option>
                        <option value="personal_care">Personal Care</option>
                        <option value="household">Household</option>
                        <option value="other">Other (Custom)</option>
                    </select>
                </div>
                <div id="customCategoryInput" style="display: none;">
                    <div class="form-group">
                        <label>Custom Category Name</label>
                        <input type="text" id="customCategoryName" placeholder="Enter custom category">
                        <small class="text-muted">This category will be saved for future use</small>
                    </div>
                </div>
                <div class="form-group">
                    <label>Price ()</label>
                    <input type="number" id="productPrice" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>MRP ()</label>
                    <input type="number" id="productMrp" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Stock Quantity</label>
                    <input type="number" id="productStock" required min="0">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="productDescription" rows="3"></textarea>
                </div>
                
                <!-- Product Refund Options -->
                <div class="form-group">
                    <label>Refund & Return Policy</label>
                    <div style="margin-bottom: 10px;">
                        <input type="checkbox" id="productRefundAvailable" checked>
                        <label for="productRefundAvailable" style="margin-left: 8px;">Refund & Return Available for this product</label>
                    </div>
                    <div id="productRefundDetails" style="margin-top: 10px;">
                        <div class="form-group">
                            <label>Refund Period (Days)</label>
                            <input type="number" id="productRefundPeriod" min="1" max="30" value="7">
                            <small class="text-muted">Number of days after delivery for refund eligibility</small>
                        </div>
                        <div class="form-group">
                            <label>Refund Type</label>
                            <select id="productRefundType">
                                <option value="use_shop_default">Use Shop Default Policy</option>
                                <option value="full_refund">Full Refund</option>
                                <option value="partial_refund">Partial Refund</option>
                                <option value="store_credit">Store Credit Only</option>
                                <option value="no_refund">No Refund</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Special Conditions (Optional)</label>
                            <textarea id="productRefundConditions" rows="2" placeholder="e.g., Non-returnable if opened, sealed items only..."></textarea>
                            <small class="text-muted">Leave empty to use shop default conditions</small>
                        </div>
                    </div>
                </div>
                
                <!-- Cloudinary Image Upload Section -->
                <div class="form-group">
                    <label>Product Image</label>
                    <div class="image-upload-container">
                        <div class="image-upload-option">
                            <div class="upload-tab active" data-type="url" onclick="switchImageTab('url')">
                                <i class="fas fa-link"></i>
                                <span>Image URL</span>
                            </div>
                            <div class="upload-tab" data-type="cloudinary" onclick="switchImageTab('cloudinary')">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Upload with Cloudinary</span>
                            </div>
                        </div>
                        
                        <!-- URL Input -->
                        <div class="image-preview-container active" id="urlTab">
                            <input type="url" id="productImage" placeholder="https://example.com/image.jpg">
                            <button type="button" class="upload-btn" onclick="previewImageFromUrl()">
                                <i class="fas fa-eye"></i> Preview Image
                            </button>
                            <img id="urlImagePreview" class="image-preview" style="display: none;">
                        </div>
                        
                        <!-- Cloudinary Upload -->
                        <div class="image-preview-container" id="cloudinaryTab">
                            <button type="button" class="upload-btn" onclick="openCloudinaryUploader()">
                                <i class="fas fa-cloud-upload-alt"></i> Upload Product Image
                            </button>
                            <div id="cloudinaryUploadStatus" style="display: none; margin-top: 10px;">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Uploading to Cloudinary...</span>
                                </div>
                            </div>
                            <img id="cloudinaryImagePreview" class="image-preview" style="display: none;">
                            <div id="cloudinaryImageInfo" style="display: none; margin-top: 10px; font-size: 0.9rem; color: #666;">
                                <i class="fas fa-check-circle text-success"></i>
                                <span>Image uploaded to Cloudinary successfully</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="cloudinaryImageUrl">
                </div>
            </form>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-outline" onclick="closeProductModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProduct()">Save Product</button>
            </div>
        </div>
    </div>

    <!-- Partial Order Modal -->
    <div class="modal" id="partialOrderModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Accept Partial Order</h3>
                <button class="close-modal" onclick="closePartialOrderModal()">&times;</button>
            </div>
            <div id="partialOrderItems">
                <!-- Items will be loaded here -->
            </div>
            <div id="partialOrderTotal" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; text-align: right;">
                <strong>Total: <span id="partialOrderTotalAmount">0</span></strong>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-outline" onclick="closePartialOrderModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmPartialOrder()">Confirm Partial Order</button>
            </div>
        </div>
    </div>

    <!-- Order Details Full Screen Modal -->
    <div class="order-details-fullscreen" id="orderDetailsModal">
        <div class="order-details-header">
            <h2><i class="fas fa-shopping-bag"></i> Order Details</h2>
            <button class="close-modal" onclick="closeOrderDetailsModal()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>
        <div class="order-details-content" id="orderDetailsContent">
            <!-- Order details will be loaded here -->
        </div>
    </div>

    <!-- Order Items Status Modal -->
    <div class="modal" id="orderItemsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Update Order Items Status</h3>
                <button class="close-modal" onclick="closeOrderItemsModal()">&times;</button>
            </div>
            <div id="orderItemsList">
                <!-- Order items will be loaded here -->
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-outline" onclick="closeOrderItemsModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveOrderItemsStatus()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Initiate Refund Modal -->
    <div class="modal" id="initiateRefundModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Initiate Refund</h3>
                <button class="close-modal" onclick="closeInitiateRefundModal()">&times;</button>
            </div>
            <form id="refundForm">
                <input type="hidden" id="refundOrderId">
                <input type="hidden" id="refundCustomerId">
                
                <div class="form-group">
                    <label>Order ID</label>
                    <input type="text" id="displayOrderId" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label>Customer</label>
                    <input type="text" id="refundCustomerName" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label>Refund Items</label>
                    <div id="refundItemsList">
                        <!-- Items will be loaded here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Refund Amount ()</label>
                    <input type="number" id="refundAmount" class="form-control" required min="0" step="0.01">
                    <small class="text-muted">Maximum refundable amount: <span id="maxRefundAmount">0</span></small>
                </div>
                
                <div class="form-group">
                    <label>Refund Reason</label>
                    <select id="refundReason" class="form-select" required>
                        <option value="">Select Reason</option>
                        <option value="Product Quality Issue">Product Quality Issue</option>
                        <option value="Wrong Product Delivered">Wrong Product Delivered</option>
                        <option value="Damaged Product">Damaged Product</option>
                        <option value="Order Cancelled">Order Cancelled</option>
                        <option value="Customer Request">Customer Request</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="refundNotes" rows="3" class="form-control" placeholder="Any additional information about the refund..."></textarea>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Refund will be processed within 24-48 hours. Customer will be notified via email/SMS.
                </div>
            </form>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-outline" onclick="closeInitiateRefundModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitRefund()">Initiate Refund</button>
            </div>
        </div>
    </div>

    <!-- Refund Details Modal -->
    <div class="modal" id="refundDetailsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Refund Details</h3>
                <button class="close-modal" onclick="closeRefundDetailsModal()">&times;</button>
            </div>
            <div id="refundDetailsContent">
                <!-- Refund details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- New Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-chart-bar"></i> Generate Report</h3>
                <button class="close-modal" onclick="closeReportModal()">&times;</button>
            </div>
            <form id="reportForm">
                <div class="form-group">
                    <label>Report Type</label>
                    <select id="reportType" class="form-control">
                        <option value="sales">Sales Report</option>
                        <option value="inventory">Inventory Report</option>
                        <option value="customer">Customer Report</option>
                        <option value="financial">Financial Report</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="reportStartDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="reportEndDate" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>Format</label>
                    <select id="reportFormat" class="form-control">
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                        <option value="pdf">PDF</option>
                    </select>
                </div>
            </form>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-outline" onclick="closeReportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-download"></i> Generate Report
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Quick Actions Toolbar -->
    <div class="quick-actions-toolbar" id="quickActionsToolbar">
        <button class="quick-action-btn" data-page="dashboard" onclick="navigateToPage('dashboard')">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
        </button>
        <button class="quick-action-btn" data-page="orders" onclick="navigateToPage('orders')">
            <i class="fas fa-shopping-bag"></i>
            <span>Orders</span>
            <span class="orders-badge" style="display: none;">0</span>
        </button>
        <button class="quick-action-btn" data-page="refunds" onclick="navigateToPage('refunds')">
            <i class="fas fa-exchange-alt"></i>
            <span>Refunds</span>
        </button>
        <button class="quick-action-btn" data-page="profile" onclick="navigateToPage('profile')">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </button>
    </div>

    <script>
        // ==================== FIXED FIREBASE CONFIGURATION ====================
        
        // Updated Firebase Configuration with correct values
        const firebaseConfig = {
            apiKey: "AIzaSyD2-yz4xwYD5S_oXs6ryhNP8XIC94jzda4",
            authDomain: "dukaan-platform.firebaseapp.com",
            projectId: "dukaan-platform",
            storageBucket: "dukaan-platform.firebasestorage.app",
            messagingSenderId: "75765851780",
            appId: "1:75765851780:web:dd9567db1d39c3b09c84d1",
            measurementId: "G-QPLB3XQ4D6"
        };

        // Cloudinary Configuration
        const cloudinaryConfig = {
            cloudName: 'db1rbtgpe',
            uploadPreset: 'dukaan-platform',
            apiKey: '156538295145313',
            sources: ['local', 'camera', 'url'],
            folder: 'samples/ecommerce',
            multiple: false,
            resourceType: 'image',
            clientAllowedFormats: ['jpg', 'png', 'gif', 'webp', 'jpeg'],
            maxFileSize: 5000000,
            theme: 'white',
            cropping: false,
            showAdvancedOptions: false,
            styles: {
                palette: {
                    window: "#FFFFFF",
                    windowBorder: "#0F2C59",
                    tabIcon: "#0F2C59",
                    menuIcons: "#0F2C59",
                    textDark: "#000000",
                    textLight: "#FFFFFF",
                    link: "#0F2C59",
                    action: "#0F2C59",
                    inactiveTabIcon: "#555555",
                    error: "#F44235",
                    inProgress: "#0078FF",
                    complete: "#20B832",
                    sourceBg: "#E4EBF1"
                }
            }
        };

        // ==================== GLOBAL VARIABLES ====================
        let auth = null;
        let db = null;
        let storage = null;
        let currentShop = null;
        let products = [];
        let orders = [];
        let filteredOrders = [];
        let refunds = [];
        let filteredRefunds = [];
        let currentPartialOrderId = null;
        let partialOrderItems = [];
        let currentRefundOrder = null;
        let isOnline = navigator.onLine;
        let ordersListener = null;
        let messaging = null;
        let currentImageTab = 'url';
        let cloudinaryWidget = null;
        let notificationSound = null;
        let currentShopConfig = null;
        let currentOrderItems = [];
        let shopCategories = ['groceries', 'dairy', 'bakery', 'beverages', 'snacks', 'personal_care', 'household'];

        // New variables for enhanced features
        let currentPage = 1;
        const productsPerPage = 12;
        let totalProducts = 0;
        let searchTimeout = null;
        let charts = {};

        // ==================== BASIC INITIALIZATION ====================
        
        function initApp() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                } else {
                    firebase.app();
                }
                
                auth = firebase.auth();
                db = firebase.firestore();
                storage = firebase.storage();
                
                // Enable offline persistence
                db.enablePersistence()
                    .catch((err) => {
                        console.log('Persistence failed:', err);
                    });
                
                // Setup auth state listener
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        console.log("User logged in:", user.email);
                        await loadShopData(user.uid);
                        showAppScreen();
                    } else {
                        showAuthScreen();
                    }
                });
                
                setupNetworkDetection();
                initializeCloudinaryWidget();
                
                // Check initial auth state
                if (auth.currentUser) {
                    loadShopData(auth.currentUser.uid);
                    showAppScreen();
                } else {
                    showAuthScreen();
                }
                
                showToast("App initialized successfully", "success");
                
            } catch (error) {
                console.error("Firebase initialization error:", error);
                showToast("Firebase initialization failed. Please refresh the page.", "error");
            }
        }

        // ==================== SCREEN MANAGEMENT ====================
        
        function showAuthScreen() {
            document.getElementById('authScreen').style.display = 'block';
            document.getElementById('appScreen').style.display = 'none';
        }
        
        function showAppScreen() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            navigateToPage('dashboard');
        }

        // ==================== LOGIN FUNCTION ====================
        
        async function handleLogin(event) {
            if (event) event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }
            
            try {
                showLoading(true);
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log("Login successful:", user.email);
                showToast('Login successful!', 'success');
                
                await loadShopData(user.uid);
                showAppScreen();
                
            } catch (error) {
                console.error("Login error:", error);
                let errorMessage = 'Login failed. ';
                
                switch(error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address format.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled.';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Network error. Check your internet connection.';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showToast(errorMessage, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ==================== SHOP DATA LOADING ====================
        
        async function loadShopData(userId) {
    try {
        showLoading(true);
        
        // Try to get shop by ownerId first
        let shopSnapshot = await db.collection('shops')
            .where('ownerId', '==', userId)
            .limit(1)
            .get();
        
        // If no shop found by ownerId, try by uid (for backward compatibility)
        if (shopSnapshot.empty) {
            shopSnapshot = await db.collection('shops')
                .where('uid', '==', userId)
                .limit(1)
                .get();
        }
        
        // If still no shop found, try direct document ID (shopId = userId)
        if (shopSnapshot.empty) {
            try {
                const shopDoc = await db.collection('shops').doc(userId).get();
                if (shopDoc.exists) {
                    currentShop = {
                        id: shopDoc.id,
                        ...shopDoc.data()
                    };
                }
            } catch (error) {
                console.log("No shop found with direct ID either");
            }
        } else {
            const shopDoc = shopSnapshot.docs[0];
            currentShop = {
                id: shopDoc.id,
                ...shopDoc.data()
            };
        }
        
        if (currentShop) {
            console.log("Shop loaded:", currentShop.name || currentShop.id);
            
            // Load initial data
            await loadProducts();
            await loadOrders();
            await loadRefunds();
            await loadDashboardData();
            
            showToast(`Welcome back, ${currentShop.name || 'Shopkeeper'}!`, 'success');
        } else {
            console.log("No shop found for user");
            showToast('No shop found for this account. Please contact admin to create a shop.', 'error');
            // Don't logout, let them see the interface but show message
        }
        
    } catch (error) {
        console.error("Error loading shop data:", error);
        showToast('Error loading shop data: ' + error.message, 'error');
    } finally {
        showLoading(false);
    }
}
        // ==================== BASIC DATA LOADING FUNCTIONS ====================
        
        async function loadProducts() {
            if (!currentShop) return;
            
            try {
                const snapshot = await db.collection('products')
                    .where('shopId', '==', currentShop.id)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                products = [];
                snapshot.forEach(doc => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                
                document.getElementById('totalProducts').textContent = products.length;
                renderProducts();
                checkInventoryAlerts();
                
            } catch (error) {
                console.error("Error loading products:", error);
            }
        }
        
        async function loadOrders() {
            if (!currentShop) return;
            
            try {
                const snapshot = await db.collection('orders')
                    .where('shopId', '==', currentShop.id)
                    .orderBy('createdAt', 'desc')
                    .limit(100)
                    .get();
                
                orders = [];
                snapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                filteredOrders = [...orders];
                renderOrders();
                updateOrdersSummary();
                
                // Update pending orders count
                const pendingCount = orders.filter(o => o.status === 'pending').length;
                document.getElementById('pendingOrders').textContent = pendingCount;
                
                // Update orders badge
                const badge = document.querySelector('.orders-badge');
                if (badge && pendingCount > 0) {
                    badge.textContent = pendingCount;
                    badge.style.display = 'inline';
                }
                
            } catch (error) {
                console.error("Error loading orders:", error);
            }
        }
        
        async function loadRefunds() {
            if (!currentShop) return;
            
            try {
                const snapshot = await db.collection('refunds')
                    .where('shopId', '==', currentShop.id)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                refunds = [];
                snapshot.forEach(doc => {
                    refunds.push({ id: doc.id, ...doc.data() });
                });
                
                filteredRefunds = [...refunds];
                renderRefunds();
                updateRefundsSummary();
                
                // Update pending refunds count
                const pendingCount = refunds.filter(r => r.status === 'pending').length;
                document.getElementById('pendingRefunds').textContent = pendingCount;
                
            } catch (error) {
                console.error("Error loading refunds:", error);
            }
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        
        async function loadDashboardData() {
            if (!currentShop) return;
            
            try {
                // Calculate today's revenue
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const ordersSnapshot = await db.collection('orders')
                    .where('shopId', '==', currentShop.id)
                    .where('status', 'in', ['delivered', 'picked_up'])
                    .where('createdAt', '>=', today)
                    .get();
                
                let todayRevenue = 0;
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    todayRevenue += order.total || order.totalAmount || 0;
                });
                
                document.getElementById('todayRevenue').textContent = `${todayRevenue.toFixed(2)}`;
                
                // Load dashboard orders summary
                updateDashboardOrdersSummary();
                
            } catch (error) {
                console.error("Error loading dashboard data:", error);
            }
        }
        
        function updateDashboardOrdersSummary() {
            const pending = orders.filter(o => o.status === 'pending').length;
            const confirmed = orders.filter(o => o.status === 'confirmed').length;
            const preparing = orders.filter(o => o.status === 'preparing').length;
            const delivered = orders.filter(o => o.status === 'delivered').length;
            
            const html = `
                <div class="dashboard-stat pending">
                    <span class="dashboard-stat-value">${pending}</span>
                    <span class="dashboard-stat-label">Pending Orders</span>
                </div>
                <div class="dashboard-stat confirmed">
                    <span class="dashboard-stat-value">${confirmed}</span>
                    <span class="dashboard-stat-label">Confirmed</span>
                </div>
                <div class="dashboard-stat preparing">
                    <span class="dashboard-stat-value">${preparing}</span>
                    <span class="dashboard-stat-label">Preparing</span>
                </div>
                <div class="dashboard-stat delivered">
                    <span class="dashboard-stat-value">${delivered}</span>
                    <span class="dashboard-stat-label">Delivered</span>
                </div>
            `;
            
            document.getElementById('dashboardOrdersStats').innerHTML = html;
        }

        // ==================== RENDERING FUNCTIONS ====================
        
        function renderProducts() {
            const productsList = document.getElementById('productsList');
            
            if (products.length === 0) {
                productsList.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <i class="fas fa-box-open" style="font-size: 4rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3 style="color: #666; margin-bottom: 1rem;">No Products Found</h3>
                        <p style="color: #999; margin-bottom: 2rem;">Add your first product to start selling</p>
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i> Add Your First Product
                        </button>
                    </div>
                `;
                return;
            }
            
            let productsHtml = '';
            products.forEach((product) => {
                let stockClass = 'in-stock';
                let stockText = '';
                let stockIcon = 'check-circle';
                
                if (product.stock > 10) {
                    stockClass = 'in-stock';
                    stockText = `${product.stock} in stock`;
                    stockIcon = 'check-circle';
                } else if (product.stock > 0) {
                    stockClass = 'low-stock';
                    stockText = `Low stock (${product.stock})`;
                    stockIcon = 'exclamation-circle';
                } else {
                    stockClass = 'out-of-stock';
                    stockText = 'Out of stock';
                    stockIcon = 'times-circle';
                }

                let discountBadge = '';
                if (product.mrp && product.mrp > product.price) {
                    const discountPercent = Math.round(((product.mrp - product.price) / product.mrp) * 100);
                    if (discountPercent > 0) {
                        discountBadge = `<span class="product-discount">${discountPercent}% OFF</span>`;
                    }
                }

                const productImage = product.image || 'https://cdn-icons-png.flaticon.com/512/3148/3148829.png';

                productsHtml += `
                    <div class="product-card">
                        <div class="product-image-container">
                            <img src="${productImage}" 
                                 alt="${product.name}" class="product-image">
                            <span class="product-badge">${product.category || 'Product'}</span>
                        </div>
                        <div class="product-details">
                            <h3 class="product-title">${product.name}</h3>
                            
                            <div class="product-price-row">
                                <span class="product-price">${parseFloat(product.price || 0).toFixed(2)}</span>
                                ${product.mrp && product.mrp > product.price ? 
                                    `<span class="product-mrp">${parseFloat(product.mrp).toFixed(2)}</span>` : ''}
                                ${discountBadge}
                            </div>
                            
                            <div class="product-stock ${stockClass}">
                                <i class="fas fa-${stockIcon}"></i>
                                ${stockText}
                            </div>
                            
                            ${product.description ? `<p style="color: #666; font-size: 0.85rem; margin-top: 0.5rem;">${product.description.substring(0, 60)}${product.description.length > 60 ? '...' : ''}</p>` : ''}
                            
                            <div class="product-actions">
                                <button class="btn-edit-product" onclick="editProduct('${product.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-add-product" onclick="deleteProduct('${product.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            productsList.innerHTML = productsHtml;
        }
        
        function renderOrders() {
            const ordersList = document.getElementById('ordersList');
            
            if (filteredOrders.length === 0) {
                ordersList.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-shopping-bag" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                            <h4 style="color: #666;">No Orders Found</h4>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let ordersHtml = '';
            filteredOrders.forEach((order) => {
                const customerName = order.customerName || order.customer?.name || 'Customer';
                const itemsCount = order.items ? order.items.length : 0;
                const totalAmount = order.total || order.totalAmount || 0;
                const status = order.status || 'pending';
                const paymentStatus = order.paymentStatus || 'unpaid';
                const date = order.createdAt ? 
                    (order.createdAt.toDate ? order.createdAt.toDate().toLocaleDateString() : 
                    new Date(order.createdAt).toLocaleDateString()) : 'N/A';
                
                // Status class
                const statusClass = `status-${status}`;
                
                // Payment class
                let paymentClass = 'payment-unpaid';
                if (paymentStatus === 'paid') {
                    paymentClass = 'payment-paid';
                } else if (paymentStatus === 'cod-paid') {
                    paymentClass = 'payment-cod-paid';
                }
                
                ordersHtml += `
                    <tr>
                        <td>${order.id.substring(0, 8)}...</td>
                        <td>${customerName}</td>
                        <td>${itemsCount} items</td>
                        <td>${totalAmount.toFixed(2)}</td>
                        <td><span class="status-text ${statusClass}">${status}</span></td>
                        <td><span class="payment-text ${paymentClass}">${paymentStatus}</span></td>
                        <td>${date}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewOrderDetails('${order.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${status === 'pending' ? `
                                <button class="btn btn-sm btn-success" onclick="updateOrderStatus('${order.id}', 'confirmed')">
                                    <i class="fas fa-check"></i> Accept
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="updateOrderStatus('${order.id}', 'rejected')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            ordersList.innerHTML = ordersHtml;
        }
        
        function renderRefunds() {
            const refundsList = document.getElementById('refundsList');
            
            if (filteredRefunds.length === 0) {
                refundsList.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-exchange-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                            <h4 style="color: #666;">No Refunds Found</h4>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let refundsHtml = '';
            filteredRefunds.forEach((refund) => {
                const customerName = refund.customerName || refund.customer?.name || 'Customer';
                const amount = refund.amount || 0;
                const reason = refund.reason || 'N/A';
                const status = refund.status || 'pending';
                const date = refund.createdAt ? 
                    (refund.createdAt.toDate ? refund.createdAt.toDate().toLocaleDateString() : 
                    new Date(refund.createdAt).toLocaleDateString()) : 'N/A';
                
                // Status class
                const statusClass = `status-refund_${status}`;
                
                refundsHtml += `
                    <tr>
                        <td>${refund.id.substring(0, 8)}...</td>
                        <td>${refund.orderId?.substring(0, 8) || 'N/A'}...</td>
                        <td>${customerName}</td>
                        <td>${amount.toFixed(2)}</td>
                        <td>${reason.substring(0, 20)}${reason.length > 20 ? '...' : ''}</td>
                        <td><span class="status-text ${statusClass}">${status}</span></td>
                        <td>${date}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewRefundDetails('${refund.id}')">
                                <i class="fas fa-eye"></i> Details
                            </button>
                            ${status === 'pending' ? `
                                <button class="btn btn-sm btn-success" onclick="updateRefundStatus('${refund.id}', 'completed')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="updateRefundStatus('${refund.id}', 'rejected')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            refundsList.innerHTML = refundsHtml;
        }

        // ==================== ORDER FUNCTIONS ====================
        
        function filterOrders() {
            const filter = document.getElementById('orderStatusFilter').value;
            
            if (filter === 'all') {
                filteredOrders = [...orders];
            } else {
                filteredOrders = orders.filter(order => order.status === filter);
            }
            
            renderOrders();
        }
        
        async function updateOrderStatus(orderId, newStatus) {
            try {
                showLoading(true);
                
                await db.collection('orders').doc(orderId).update({
                    status: newStatus,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showToast(`Order ${newStatus} successfully`, 'success');
                
                // Reload orders
                await loadOrders();
                
            } catch (error) {
                console.error("Error updating order:", error);
                showToast('Error updating order', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function viewOrderDetails(orderId) {
            try {
                showLoading(true);
                
                const orderDoc = await db.collection('orders').doc(orderId).get();
                if (!orderDoc.exists) {
                    showToast('Order not found', 'error');
                    return;
                }
                
                const order = { id: orderDoc.id, ...orderDoc.data() };
                
                // Build order details HTML
                let itemsHtml = '';
                if (order.items && order.items.length > 0) {
                    itemsHtml = `
                        <table class="order-items-table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr>
                                        <td>${item.name || 'Product'}</td>
                                        <td>${item.quantity || 1}</td>
                                        <td>${item.price ? parseFloat(item.price).toFixed(2) : '0.00'}</td>
                                        <td>${item.total ? parseFloat(item.total).toFixed(2) : '0.00'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
                
                const html = `
                    <div class="order-section">
                        <h4><i class="fas fa-info-circle"></i> Order Information</h4>
                        <div class="order-grid">
                            <div class="order-info-item">
                                <div class="order-info-label">Order ID</div>
                                <div class="order-info-value">${order.id}</div>
                            </div>
                            <div class="order-info-item">
                                <div class="order-info-label">Status</div>
                                <div class="order-info-value"><span class="status-text status-${order.status}">${order.status}</span></div>
                            </div>
                            <div class="order-info-item">
                                <div class="order-info-label">Payment Status</div>
                                <div class="order-info-value"><span class="payment-text payment-${order.paymentStatus || 'unpaid'}">${order.paymentStatus || 'unpaid'}</span></div>
                            </div>
                            <div class="order-info-item">
                                <div class="order-info-label">Date</div>
                                <div class="order-info-value">${order.createdAt ? (order.createdAt.toDate ? order.createdAt.toDate().toLocaleString() : new Date(order.createdAt).toLocaleString()) : 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="order-section">
                        <h4><i class="fas fa-user"></i> Customer Information</h4>
                        <div class="order-grid">
                            <div class="order-info-item">
                                <div class="order-info-label">Name</div>
                                <div class="order-info-value">${order.customerName || order.customer?.name || 'Customer'}</div>
                            </div>
                            <div class="order-info-item">
                                <div class="order-info-label">Phone</div>
                                <div class="order-info-value">${order.customerPhone || order.customer?.phone || 'N/A'}</div>
                            </div>
                            <div class="order-info-item">
                                <div class="order-info-label">Address</div>
                                <div class="order-info-value">${order.deliveryAddress || order.customer?.address || 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="order-section">
                        <h4><i class="fas fa-shopping-cart"></i> Order Items</h4>
                        ${itemsHtml || '<p>No items found</p>'}
                    </div>
                    
                    <div class="order-total">
                        <h4>Order Total: <span class="total-amount">${order.total ? parseFloat(order.total).toFixed(2) : '0.00'}</span></h4>
                    </div>
                `;
                
                document.getElementById('orderDetailsContent').innerHTML = html;
                document.getElementById('orderDetailsModal').classList.add('active');
                
            } catch (error) {
                console.error("Error loading order details:", error);
                showToast('Error loading order details', 'error');
            } finally {
                showLoading(false);
            }
        }

        // ==================== REFUND FUNCTIONS ====================
        
        function filterRefunds() {
            const filter = document.getElementById('refundStatusFilter').value;
            
            if (filter === 'all') {
                filteredRefunds = [...refunds];
            } else {
                filteredRefunds = refunds.filter(refund => refund.status === filter);
            }
            
            renderRefunds();
        }
        
        function updateRefundsSummary() {
            const pending = refunds.filter(r => r.status === 'pending').length;
            const completed = refunds.filter(r => r.status === 'completed').length;
            const rejected = refunds.filter(r => r.status === 'rejected').length;
            const totalAmount = refunds.reduce((sum, refund) => sum + (refund.amount || 0), 0);
            
            document.getElementById('refundStatsPending').textContent = pending;
            document.getElementById('refundStatsCompleted').textContent = completed;
            document.getElementById('refundStatsRejected').textContent = rejected;
            document.getElementById('refundStatsAmount').textContent = `${totalAmount.toFixed(2)}`;
        }
        
        async function updateRefundStatus(refundId, newStatus) {
            try {
                showLoading(true);
                
                await db.collection('refunds').doc(refundId).update({
                    status: newStatus,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showToast(`Refund ${newStatus} successfully`, 'success');
                
                // Reload refunds
                await loadRefunds();
                
            } catch (error) {
                console.error("Error updating refund:", error);
                showToast('Error updating refund', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        function viewRefundDetails(refundId) {
            const refund = refunds.find(r => r.id === refundId);
            if (!refund) {
                showToast('Refund not found', 'error');
                return;
            }
            
            const html = `
                <div class="order-grid">
                    <div class="order-info-item">
                        <div class="order-info-label">Refund ID</div>
                        <div class="order-info-value">${refund.id}</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Order ID</div>
                        <div class="order-info-value">${refund.orderId || 'N/A'}</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Customer</div>
                        <div class="order-info-value">${refund.customerName || refund.customer?.name || 'Customer'}</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Amount</div>
                        <div class="order-info-value">${refund.amount ? parseFloat(refund.amount).toFixed(2) : '0.00'}</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Status</div>
                        <div class="order-info-value"><span class="status-text status-refund_${refund.status}">${refund.status}</span></div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Reason</div>
                        <div class="order-info-value">${refund.reason || 'N/A'}</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Notes</div>
                        <div class="order-info-value">${refund.notes || 'N/A'}</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Initiated On</div>
                        <div class="order-info-value">${refund.createdAt ? (refund.createdAt.toDate ? refund.createdAt.toDate().toLocaleString() : new Date(refund.createdAt).toLocaleString()) : 'N/A'}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('refundDetailsContent').innerHTML = html;
            document.getElementById('refundDetailsModal').classList.add('active');
        }

        // ==================== PRODUCT MANAGEMENT ====================
        
        function showAddProductModal() {
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('editProductId').value = '';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').classList.add('active');
        }
        
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showToast('Product not found', 'error');
                return;
            }
            
            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('editProductId').value = product.id;
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productCategory').value = product.category || 'groceries';
            document.getElementById('productPrice').value = product.price || 0;
            document.getElementById('productMrp').value = product.mrp || product.price || 0;
            document.getElementById('productStock').value = product.stock || 0;
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productImage').value = product.image || '';
            
            // Show custom category input if needed
            if (product.category === 'other') {
                document.getElementById('customCategoryInput').style.display = 'block';
                document.getElementById('customCategoryName').value = product.customCategory || '';
            }
            
            document.getElementById('productModal').classList.add('active');
        }
        
        async function saveProduct() {
            try {
                showLoading(true);
                
                const productData = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    mrp: parseFloat(document.getElementById('productMrp').value) || parseFloat(document.getElementById('productPrice').value),
                    stock: parseInt(document.getElementById('productStock').value),
                    description: document.getElementById('productDescription').value,
                    image: document.getElementById('productImage').value || 'https://cdn-icons-png.flaticon.com/512/3148/3148829.png',
                    shopId: currentShop.id,
                    shopName: currentShop.name,
                    isAvailable: true,
                    status: 'active',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add custom category if needed
                if (productData.category === 'other') {
                    productData.customCategory = document.getElementById('customCategoryName').value;
                }
                
                const productId = document.getElementById('editProductId').value;
                
                if (productId) {
                    // Update existing product
                    await db.collection('products').doc(productId).update(productData);
                    showToast('Product updated successfully', 'success');
                } else {
                    // Add new product
                    productData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('products').add(productData);
                    showToast('Product added successfully', 'success');
                }
                
                closeProductModal();
                await loadProducts();
                
            } catch (error) {
                console.error("Error saving product:", error);
                showToast('Error saving product', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            try {
                showLoading(true);
                await db.collection('products').doc(productId).delete();
                showToast('Product deleted successfully', 'success');
                await loadProducts();
            } catch (error) {
                console.error("Error deleting product:", error);
                showToast('Error deleting product', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        function checkInventoryAlerts() {
            const lowStockProducts = products.filter(p => p.stock <= 10 && p.stock > 0);
            const outOfStockProducts = products.filter(p => p.stock <= 0);
            
            const totalAlerts = lowStockProducts.length + outOfStockProducts.length;
            
            if (totalAlerts === 0) {
                document.getElementById('inventoryAlerts').style.display = 'none';
                document.getElementById('productsInventoryAlerts').style.display = 'none';
                return;
            }
            
            let alertsHtml = '';
            
            lowStockProducts.forEach(product => {
                alertsHtml += `
                    <div class="alert-item low-stock">
                        <div>
                            <strong>${product.name}</strong>
                            <div class="text-muted">Stock: ${product.stock}</div>
                        </div>
                        <button class="btn btn-sm btn-warning" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i> Restock
                        </button>
                    </div>
                `;
            });
            
            outOfStockProducts.forEach(product => {
                alertsHtml += `
                    <div class="alert-item out-of-stock">
                        <div>
                            <strong>${product.name}</strong>
                            <div class="text-danger">Out of Stock</div>
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="editProduct('${product.id}')">
                            <i class="fas fa-plus"></i> Restock
                        </button>
                    </div>
                `;
            });
            
            document.getElementById('inventoryAlerts').style.display = 'block';
            document.getElementById('alertItems').innerHTML = alertsHtml;
            
            document.getElementById('productsInventoryAlerts').style.display = 'block';
            document.getElementById('productsAlertItems').innerHTML = alertsHtml;
        }

        // ==================== SETTINGS FUNCTIONS ====================
        
        function toggleCouponSystem() {
            const enabled = document.getElementById('couponSystemEnabled').checked;
            document.getElementById('couponSettingsSection').style.display = enabled ? 'block' : 'none';
            document.getElementById('couponSystemStatus').textContent = 
                `Coupon System: ${enabled ? 'Enabled' : 'Disabled'}`;
        }
        
        async function saveUPISettings() {
            try {
                showLoading(true);
                
                const upiSettings = {
                    upiId: document.getElementById('upiId').value,
                    qrCodeImage: document.getElementById('qrCodeImage').value,
                    acceptCash: document.getElementById('acceptCash').checked,
                    acceptUPI: document.getElementById('acceptUPI').checked,
                    acceptCard: document.getElementById('acceptCard').checked,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Save to Firestore
                await db.collection('shopSettings').doc(currentShop.id).set({
                    upiSettings: upiSettings
                }, { merge: true });
                
                showToast('Payment settings saved successfully', 'success');
                
            } catch (error) {
                console.error("Error saving UPI settings:", error);
                showToast('Error saving settings', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        async function saveCouponSettings() {
            try {
                showLoading(true);
                
                const couponData = {
                    code: document.getElementById('couponCode').value,
                    discountType: document.getElementById('couponDiscountType').value,
                    value: parseFloat(document.getElementById('couponValue').value),
                    minOrder: parseFloat(document.getElementById('couponMinOrder').value) || 0,
                    maxDiscount: parseFloat(document.getElementById('couponMaxDiscount').value) || 0,
                    validUntil: document.getElementById('couponValidUntil').value || null,
                    usageLimit: parseInt(document.getElementById('couponUsageLimit').value) || 0,
                    active: document.getElementById('couponActive').value === 'true',
                    description: document.getElementById('couponDescription').value,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('coupons').add({
                    ...couponData,
                    shopId: currentShop.id,
                    shopName: currentShop.name
                });
                
                showToast('Coupon created successfully', 'success');
                clearCouponForm();
                
            } catch (error) {
                console.error("Error saving coupon:", error);
                showToast('Error saving coupon', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        function clearCouponForm() {
            document.getElementById('couponCode').value = '';
            document.getElementById('couponDiscountType').value = 'percentage';
            document.getElementById('couponValue').value = '';
            document.getElementById('couponMinOrder').value = '';
            document.getElementById('couponMaxDiscount').value = '';
            document.getElementById('couponValidUntil').value = '';
            document.getElementById('couponUsageLimit').value = '';
            document.getElementById('couponActive').value = 'true';
            document.getElementById('couponDescription').value = '';
        }

        // ==================== UTILITY FUNCTIONS ====================
        
        function navigateToPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.content-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(`${pageName}Page`).classList.add('active');
            
            // Update quick actions toolbar
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === pageName) {
                    btn.classList.add('active');
                }
            });
            
            // Load data if needed
            if (pageName === 'products') {
                loadProducts();
            } else if (pageName === 'orders') {
                loadOrders();
            } else if (pageName === 'refunds') {
                loadRefunds();
            } else if (pageName === 'dashboard') {
                loadDashboardData();
            }
        }
        
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) {
                spinner.style.display = show ? 'block' : 'none';
            }
        }
        
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<div class="toast-message">${message}</div>`;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }
        
        function updateOrdersSummary() {
            const pending = orders.filter(o => o.status === 'pending').length;
            const confirmed = orders.filter(o => o.status === 'confirmed').length;
            const preparing = orders.filter(o => o.status === 'preparing').length;
            const total = orders.length;
            
            document.getElementById('pendingSummary').textContent = pending;
            document.getElementById('confirmedSummary').textContent = confirmed;
            document.getElementById('preparingSummary').textContent = preparing;
            document.getElementById('totalSummary').textContent = total;
        }
        
        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }
        
        function closePartialOrderModal() {
            document.getElementById('partialOrderModal').classList.remove('active');
        }
        
        function closeOrderDetailsModal() {
            document.getElementById('orderDetailsModal').classList.remove('active');
        }
        
        function closeOrderItemsModal() {
            document.getElementById('orderItemsModal').classList.remove('active');
        }
        
        function closeInitiateRefundModal() {
            document.getElementById('initiateRefundModal').classList.remove('active');
        }
        
        function closeRefundDetailsModal() {
            document.getElementById('refundDetailsModal').classList.remove('active');
        }
        
        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }
        
        function switchImageTab(tab) {
            currentImageTab = tab;
            document.querySelectorAll('.upload-tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelectorAll('.image-preview-container').forEach(c => {
                c.classList.remove('active');
            });
            
            document.querySelector(`.upload-tab[data-type="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}Tab`).classList.add('active');
        }
        
        function previewImageFromUrl() {
            const url = document.getElementById('productImage').value;
            if (url) {
                const preview = document.getElementById('urlImagePreview');
                preview.src = url;
                preview.style.display = 'block';
            }
        }
        
        function initializeCloudinaryWidget() {
            if (typeof cloudinary === 'undefined') return;
            
            cloudinaryWidget = cloudinary.createUploadWidget({
                cloudName: cloudinaryConfig.cloudName,
                uploadPreset: cloudinaryConfig.uploadPreset,
                sources: cloudinaryConfig.sources,
                folder: cloudinaryConfig.folder,
                multiple: cloudinaryConfig.multiple,
                resourceType: cloudinaryConfig.resourceType,
                clientAllowedFormats: cloudinaryConfig.clientAllowedFormats,
                maxFileSize: cloudinaryConfig.maxFileSize,
                theme: cloudinaryConfig.theme,
                cropping: cloudinaryConfig.cropping,
                showAdvancedOptions: cloudinaryConfig.showAdvancedOptions,
                styles: cloudinaryConfig.styles
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    document.getElementById('cloudinaryImageUrl').value = result.info.secure_url;
                    document.getElementById('productImage').value = result.info.secure_url;
                    
                    const preview = document.getElementById('cloudinaryImagePreview');
                    preview.src = result.info.secure_url;
                    preview.style.display = 'block';
                    
                    document.getElementById('cloudinaryImageInfo').style.display = 'block';
                    document.getElementById('cloudinaryUploadStatus').style.display = 'none';
                    
                    showToast('Image uploaded successfully', 'success');
                } else if (error) {
                    console.error("Cloudinary upload error:", error);
                    showToast('Image upload failed', 'error');
                    document.getElementById('cloudinaryUploadStatus').style.display = 'none';
                }
            });
        }
        
        function openCloudinaryUploader() {
            if (!cloudinaryWidget) {
                initializeCloudinaryWidget();
            }
            document.getElementById('cloudinaryUploadStatus').style.display = 'block';
            cloudinaryWidget.open();
        }
        
        function setupNetworkDetection() {
            window.addEventListener('online', () => {
                isOnline = true;
                document.getElementById('offlineWarning').style.display = 'none';
                showToast('You are back online', 'success');
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                document.getElementById('offlineWarning').style.display = 'block';
                showToast('You are offline. Some features may not work.', 'warning');
            });
        }
        
        function showForgotPassword() {
            const email = prompt("Please enter your email address to reset password:");
            if (email) {
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        showToast('Password reset email sent. Check your inbox.', 'success');
                    })
                    .catch(error => {
                        console.error("Password reset error:", error);
                        showToast('Error sending reset email: ' + error.message, 'error');
                    });
            }
        }
        
        async function logout() {
            try {
                await auth.signOut();
                showToast('Logged out successfully', 'success');
                showAuthScreen();
            } catch (error) {
                console.error("Logout error:", error);
                showToast('Error logging out', 'error');
            }
        }

        // ==================== ENHANCED FEATURES (BASIC IMPLEMENTATIONS) ====================
        
        function showBulkUpload() {
            const panel = document.getElementById('bulkUploadPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function downloadTemplate() {
            showToast('Template download feature coming soon!', 'info');
        }
        
        function exportProducts() {
            showToast('Export feature coming soon!', 'info');
        }
        
        function loadAnalytics() {
            showToast('Analytics loading...', 'info');
            // Basic implementation
            document.getElementById('totalSales').textContent = '0';
            document.getElementById('completedOrders').textContent = '0';
            document.getElementById('avgOrderValue').textContent = '0';
            document.getElementById('customerSatisfaction').textContent = '0%';
        }
        
        function showReportModal() {
            document.getElementById('reportModal').classList.add('active');
        }
        
        function generateReport() {
            showToast('Report generation coming soon!', 'info');
            closeReportModal();
        }
        
        function loadNextPage() {
            showToast('Pagination coming soon!', 'info');
        }
        
        function loadPreviousPage() {
            showToast('Pagination coming soon!', 'info');
        }
        
        function saveRestrictions() {
            showToast('Restrictions saved!', 'success');
        }
        
        function saveOrderSettings() {
            showToast('Order settings saved!', 'success');
        }
        
        function syncShopConfig() {
            showToast('Shop configuration synced!', 'success');
        }
        
        function exportShopData() {
            showToast('Export feature coming soon!', 'info');
        }
        
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to default?')) {
                showToast('Settings reset to default!', 'success');
            }
        }

        // ==================== EVENT LISTENERS ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize app
            initApp();
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Navigation
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    if (page) {
                        navigateToPage(page);
                    }
                });
            });
            
            // Quick actions
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.quick-action-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Category selection
            document.getElementById('shopCategory').addEventListener('change', function() {
                document.getElementById('newCategoryInput').style.display = 
                    this.value === 'other' ? 'block' : 'none';
            });
            
            document.getElementById('productCategory').addEventListener('change', function() {
                document.getElementById('customCategoryInput').style.display = 
                    this.value === 'other' ? 'block' : 'none';
            });
            
            // Service options
            document.querySelectorAll('.service-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.service-option').forEach(o => {
                        o.classList.remove('active');
                    });
                    this.classList.add('active');
                    document.getElementById('deliveryType').value = this.getAttribute('data-value');
                });
            });
            
            // Product form
            document.getElementById('productForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProduct();
            });
            
            // Refund form
            document.getElementById('refundForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitRefund();
            });
            
            // Analytics period change
            const analyticsPeriod = document.getElementById('analyticsPeriod');
            if (analyticsPeriod) {
                analyticsPeriod.addEventListener('change', loadAnalytics);
            }
        });

        // ==================== EXPORT FUNCTIONS TO GLOBAL SCOPE ====================
        
        window.navigateToPage = navigateToPage;
        window.showAddProductModal = showAddProductModal;
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.showBulkUpload = showBulkUpload;
        window.downloadTemplate = downloadTemplate;
        window.exportProducts = exportProducts;
        window.loadAnalytics = loadAnalytics;
        window.showReportModal = showReportModal;
        window.generateReport = generateReport;
        window.loadNextPage = loadNextPage;
        window.loadPreviousPage = loadPreviousPage;
        window.logout = logout;
        window.showForgotPassword = showForgotPassword;
        window.saveProduct = saveProduct;
        window.closeProductModal = closeProductModal;
        window.switchImageTab = switchImageTab;
        window.previewImageFromUrl = previewImageFromUrl;
        window.openCloudinaryUploader = openCloudinaryUploader;
        window.updateOrderStatus = updateOrderStatus;
        window.viewOrderDetails = viewOrderDetails;
        window.closePartialOrderModal = closePartialOrderModal;
        window.closeOrderDetailsModal = closeOrderDetailsModal;
        window.closeOrderItemsModal = closeOrderItemsModal;
        window.closeInitiateRefundModal = closeInitiateRefundModal;
        window.submitRefund = function() { showToast('Submit refund coming soon!', 'info'); };
        window.updateRefundStatus = updateRefundStatus;
        window.viewRefundDetails = viewRefundDetails;
        window.closeRefundDetailsModal = closeRefundDetailsModal;
        window.filterOrders = filterOrders;
        window.filterRefunds = filterRefunds;
        window.saveUPISettings = saveUPISettings;
        window.toggleCouponSystem = toggleCouponSystem;
        window.saveCouponSettings = saveCouponSettings;
        window.clearCouponForm = clearCouponForm;
        window.saveRestrictions = saveRestrictions;
        window.saveOrderSettings = saveOrderSettings;
        window.syncShopConfig = syncShopConfig;
        window.exportShopData = exportShopData;
        window.resetSettings = resetSettings;
        
        // Missing functions - basic implementations
        window.markAsPaid = function(orderId) { 
            showToast('Mark as paid coming soon!', 'info'); 
        };
        window.showPartialOrderModal = function() { 
            showToast('Partial order coming soon!', 'info'); 
        };
        window.confirmPartialOrder = function() { 
            showToast('Partial order confirmation coming soon!', 'info'); 
        };
        window.showOrderItemsModal = function() { 
            showToast('Order items modal coming soon!', 'info'); 
        };
        window.saveOrderItemsStatus = function() { 
            showToast('Save order items status coming soon!', 'info'); 
        };
        window.exportSalesReport = function() { 
            showToast('Export sales report coming soon!', 'info'); 
        };
        window.exportInventoryReport = function() { 
            showToast('Export inventory report coming soon!', 'info'); 
        };
        window.exportCustomerReport = function() { 
            showToast('Export customer report coming soon!', 'info'); 
        };
        window.exportFinancialReport = function() { 
            showToast('Export financial report coming soon!', 'info'); 
        };

    </script>
</body>
</html>
